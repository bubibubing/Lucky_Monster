<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>map-update documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">map-update documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">







<ol class="breadcrumb">
  <li>Injectables</li>
  <li>CrisisService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/service/crisis.service.ts</code>
        </p>

            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>This service supports the fetching of crisis reports data and is injected when required in the constructor</p>

            </p>


            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#crisisApi">crisisApi</a>
                            </li>
                            <li>
                                <a href="#crisisTypeApi">crisisTypeApi</a>
                            </li>
                            <li>
                                <a href="#mapQueryApi">mapQueryApi</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#getCrisis">getCrisis</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getCrisisAndType">getCrisisAndType</a>
                            </li>
                            <li>
                                <a href="#getCrisisType">getCrisisType</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#parseCrisisAndType">parseCrisisAndType</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>


            <section>
    
        <h3 id="methods">
            Methods
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="getCrisis"></a>
                        <span class="name">
                            <b>
                            getCrisis
                            </b>
                            <a href="#getCrisis"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
<code>getCrisis()</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="45" class="link-to-prism">src/app/service/crisis.service.ts:45</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>Get crisis reports from the call centre</p>
</div>

                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code><a href="../classes/Crisis.html" target="_self" >Observable&lt;Crisis[]&gt;</a></code>

                            </div>
                                <div class="io-description">
                                    <p>Array of crisis reports with id and details</p>

                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="getCrisisAndType"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            getCrisisAndType
                            </b>
                            <a href="#getCrisisAndType"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>getCrisisAndType()</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="52" class="link-to-prism">src/app/service/crisis.service.ts:52</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>Async function to get crisis type and reports from respective APIs at the same time</p>
</div>

                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;&gt;</code>

                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="getCrisisType"></a>
                        <span class="name">
                            <b>
                            getCrisisType
                            </b>
                            <a href="#getCrisisType"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
<code>getCrisisType()</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="38" class="link-to-prism">src/app/service/crisis.service.ts:38</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>Get crisis type from the call centre</p>
</div>

                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code><a href="../classes/CrisisType.html" target="_self" >Observable&lt;CrisisType[]&gt;</a></code>

                            </div>
                                <div class="io-description">
                                    <p>Array of crisis type with id and its name</p>

                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="parseCrisisAndType"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            parseCrisisAndType
                            </b>
                            <a href="#parseCrisisAndType"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>parseCrisisAndType(type: <a href="../classes/CrisisType.html">CrisisType[]</a>, crisis: <a href="../classes/Crisis.html">Crisis[]</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="62" class="link-to-prism">src/app/service/crisis.service.ts:62</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>This async function takes the array arguments, processes the data such that each Crisis corresponds to its respective CrisisType, finds the latitude and longitude for each Crisis location and then adds the Crisis objects into an array to be returned.</p>
</div>

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                                    <td>Description</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>type</td>
                                                        <td>
                                                                    <code><a href="../classes/CrisisType.html" target="_self" >CrisisType[]</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                        <td>
                                                                <code><p>Array of crisis types with id and names</p>
</code>
                                                        </td>
                                                </tr>
                                                <tr>
                                                        <td>crisis</td>
                                                        <td>
                                                                    <code><a href="../classes/Crisis.html" target="_self" >Crisis[]</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                        <td>
                                                                <code><p>Array of raw crisis reports</p>
</code>
                                                        </td>
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code><a href="../classes/Crisis.html" target="_self" >Promise&lt;Crisis[]&gt;</a></code>

                            </div>
                                <div class="io-description">
                                    <p>Array of parsed crisis reports</p>

                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="crisisApi"></a>
                        <span class="name">
                            <b>
                            crisisApi
                            </b>
                            <a href="#crisisApi"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <code>crisisApi:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>&quot;http://172.21.148.165:8000/api/crisis_reports&quot;</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="23" class="link-to-prism">src/app/service/crisis.service.ts:23</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>The API where crisis reports will be fetched</p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="crisisTypeApi"></a>
                        <span class="name">
                            <b>
                            crisisTypeApi
                            </b>
                            <a href="#crisisTypeApi"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <code>crisisTypeApi:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>&quot;http://172.21.148.165:8000/api/crisis_type&quot;</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="19" class="link-to-prism">src/app/service/crisis.service.ts:19</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>The API where crisis type will be fetched</p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="mapQueryApi"></a>
                        <span class="name">
                            <b>
                            mapQueryApi
                            </b>
                            <a href="#mapQueryApi"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <code>mapQueryApi:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>&quot;http://nominatim.openstreetmap.org/search?format&#x3D;json&amp;limit&#x3D;1&amp;q&#x3D;&quot;</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="28" class="link-to-prism">src/app/service/crisis.service.ts:28</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>The API where the address of the crisis report will be queried</p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } from &#x27;@angular/core&#x27;;
import { HttpClient, HttpHeaders } from &#x27;@angular/common/http&#x27;;
// import { Crises, CrisisDetails } from &#x27;./data/mock-crisis&#x27;;
import { Crisis, CrisisType } from &#x27;../data/crisis&#x27;;
import { Observable, of } from &#x27;rxjs&#x27;; 
import { Point } from &#x27;../data/loc-query&#x27;;

/**
 * This service supports the fetching of crisis reports data and is injected when required in the constructor
 */
@Injectable({
  providedIn: &#x27;root&#x27;
})
export class CrisisService {

  /**
   * The API where crisis type will be fetched
   */
  crisisTypeApi &#x3D; &quot;http://172.21.148.165:8000/api/crisis_type&quot;;
  /**
   * The API where crisis reports will be fetched
   */
  crisisApi &#x3D; &quot;http://172.21.148.165:8000/api/crisis_reports&quot;;
  // crisisApi &#x3D; &quot;http://172.21.148.165/sample.json&quot;;
  /**
   * The API where the address of the crisis report will be queried
   */
  mapQueryApi&#x3D;&quot;http://nominatim.openstreetmap.org/search?format&#x3D;json&amp;limit&#x3D;1&amp;q&#x3D;&quot;;
  /**
   * @ignore
   */
  constructor(private http:HttpClient) { }

  /**
   * Get crisis type from the call centre
   * @returns Array of crisis type with id and its name
   */
  getCrisisType():Observable&lt;CrisisType[]&gt;{
    return this.http.get&lt;CrisisType[]&gt;(this.crisisTypeApi);
  }
  /**
   * Get crisis reports from the call centre
   * @returns Array of crisis reports with id and details
   */
  getCrisis():Observable&lt;Crisis[]&gt;{
    return this.http.get&lt;Crisis[]&gt;(this.crisisApi);
  }

  /**
   * Async function to get crisis type and reports from respective APIs at the same time
   */
  async getCrisisAndType():Promise&lt;[CrisisType[], Crisis[]]&gt;{
    const arrs &#x3D; await Promise.all([this.getCrisisType().toPromise(), this.getCrisis().toPromise()]);
    return arrs;
  }
  /**
   * This async function takes the array arguments, processes the data such that each Crisis corresponds to its respective CrisisType, finds the latitude and longitude for each Crisis location and then adds the Crisis objects into an array to be returned.
   * @param type Array of crisis types with id and names
   * @param crisis Array of raw crisis reports
   * @returns Array of parsed crisis reports
   */
  async parseCrisisAndType(type:CrisisType[], crisis:Crisis[]):Promise&lt;Crisis[]&gt;{
    crisis.forEach(c&#x3D;&gt;{
      type.forEach(t &#x3D;&gt;{
        if(c.crisis_type &#x3D;&#x3D;&#x3D; t.id){
          c.type &#x3D; t.crisis_type;
        }
      });
      c.datetime &#x3D; new Date(c.create_date_time);
    });
    const promises &#x3D; crisis.map(c &#x3D;&gt;
      this.http.get&lt;Point[]&gt;(this.mapQueryApi+c.street_name+&quot; singapore&quot;).toPromise());
    const arrs &#x3D; await Promise.all(promises);
    arrs.forEach((points, i)&#x3D;&gt;{
      const loc &#x3D; points[0];
      const c &#x3D; crisis[i];
      if(loc){
        c.location &#x3D; [loc.lat, loc.lon];
      }
    });
    return crisis.filter(c &#x3D;&gt; c.location);
  }

}
</code></pre>
    </div>

</div>











                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'CrisisService.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
