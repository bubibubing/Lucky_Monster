<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>map-update documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">map-update documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">







<ol class="breadcrumb">
  <li>Injectables</li>
  <li>ShelterService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/service/shelter.service.ts</code>
        </p>

            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>This service supports the fetching of bomb shelters in Singapore and is injected when required in a constructor</p>

            </p>


            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#mapQueryApi">mapQueryApi</a>
                            </li>
                            <li>
                                <a href="#shelterApi">shelterApi</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#getRawShelter">getRawShelter</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#parseRawShelter">parseRawShelter</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>


            <section>
    
        <h3 id="methods">
            Methods
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="getRawShelter"></a>
                        <span class="name">
                            <b>
                            getRawShelter
                            </b>
                            <a href="#getRawShelter"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
<code>getRawShelter()</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="33" class="link-to-prism">src/app/service/shelter.service.ts:33</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>Get shelter information from API</p>
</div>

                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code><a href="../classes/Shelter.html" target="_self" >Observable&lt;RawShelter&gt;</a></code>

                            </div>
                                <div class="io-description">
                                    <p>Array of raw shelter information</p>

                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="parseRawShelter"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            parseRawShelter
                            </b>
                            <a href="#parseRawShelter"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>parseRawShelter(raw: <a href="../classes/Shelter.html">RawShelter</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="42" class="link-to-prism">src/app/service/shelter.service.ts:42</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>This async function takes the RawShelter object argument, processes the data to find the latitude and longitude for each Shelter location and then adds the Shelter objects (containing all the other Shelter information as well such as name and description) into an array to be returned.</p>
</div>

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                                    <td>Description</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>raw</td>
                                                        <td>
                                                                    <code><a href="../classes/Shelter.html" target="_self" >RawShelter</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                        <td>
                                                                <code><p>Array of the raw shelter data taken from the API</p>
</code>
                                                        </td>
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code><a href="../classes/Shelter.html" target="_self" >Promise&lt;Shelter[]&gt;</a></code>

                            </div>
                                <div class="io-description">
                                    <p>Array of Shelter objects</p>

                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="mapQueryApi"></a>
                        <span class="name">
                            <b>
                            mapQueryApi
                            </b>
                            <a href="#mapQueryApi"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <code>mapQueryApi:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>&quot;http://nominatim.openstreetmap.org/search?format&#x3D;json&amp;limit&#x3D;1&amp;q&#x3D;&quot;</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="23" class="link-to-prism">src/app/service/shelter.service.ts:23</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>The API where the address of bomb shelters will be queried</p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="shelterApi"></a>
                        <span class="name">
                            <b>
                            shelterApi
                            </b>
                            <a href="#shelterApi"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <code>shelterApi:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>&quot;https://data.gov.sg/api/action/datastore_search?resource_id&#x3D;4ee17930-4780-403b-b6d4-b963c7bb1c09&quot;</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="19" class="link-to-prism">src/app/service/shelter.service.ts:19</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>The API where bomb shelters information will be fetched</p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } from &#x27;@angular/core&#x27;;
import { RawShelter } from &#x27;../data/raw-shelter&#x27;;
import { Point } from &#x27;../data/loc-query&#x27;;
import { Shelter } from &#x27;../data/shelter&#x27;;
import { Observable, of } from &#x27;rxjs&#x27;; 
import { HttpClient } from &#x27;@angular/common/http&#x27;;

/**
 * This service supports the fetching of bomb shelters in Singapore and is injected when required in a constructor
 */
@Injectable({
  providedIn: &#x27;root&#x27;
})
export class ShelterService {

  /**
   * The API where bomb shelters information will be fetched
   */
  shelterApi&#x3D;&quot;https://data.gov.sg/api/action/datastore_search?resource_id&#x3D;4ee17930-4780-403b-b6d4-b963c7bb1c09&quot;;
  /**
   * The API where the address of bomb shelters will be queried
   */
  mapQueryApi&#x3D;&quot;http://nominatim.openstreetmap.org/search?format&#x3D;json&amp;limit&#x3D;1&amp;q&#x3D;&quot;;
  /**
   * @ignore
   */
  constructor(private http:HttpClient) { }
  
  /**
   * Get shelter information from API
   * @returns Array of raw shelter information
   */
  getRawShelter():Observable&lt;RawShelter&gt;{
    return this.http.get&lt;RawShelter&gt;(this.shelterApi);
  }

  /**
   * This async function takes the RawShelter object argument, processes the data to find the latitude and longitude for each Shelter location and then adds the Shelter objects (containing all the other Shelter information as well such as name and description) into an array to be returned.
   * @param raw Array of the raw shelter data taken from the API
   * @returns Array of Shelter objects
   */
  async parseRawShelter(raw:RawShelter):Promise&lt;Shelter[]&gt;{
    const shelters:Shelter[] &#x3D; [];
    const records &#x3D; raw.result.records.filter(r &#x3D;&gt; r.address)
      .map(r &#x3D;&gt; this.http.get&lt;Point[]&gt;(this.mapQueryApi+r.address).toPromise());
    const arrs &#x3D; await Promise.all(records);
    arrs.forEach((points, i) &#x3D;&gt; {
      const r &#x3D; raw.result.records[i];
      const loc &#x3D; points[0];
      if (loc) {
        shelters.push({
          name:r.name, 
          address:r.address, 
          description:r.description,
          location:[loc.lat,loc.lon]
        });
      }
    });
    return shelters;
  }
}
</code></pre>
    </div>

</div>











                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'ShelterService.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
